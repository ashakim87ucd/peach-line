<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Peach Processing Line</title>
    <meta name="description" content="Peach Processing Line" />

    <!-- Aâ€‘Frame core + extras -->
    <script src="https://aframe.io/releases/1.1.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@5.0.0/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.x/dist/aframe-look-at-component.min.js"></script>

    <!-- Reusable teleport component (replaces 15 near-identical components) -->
    <script>
      AFRAME.registerComponent('teleport-to', {
        schema: { to: { type: 'vec3' } },
        init() {
          const rig = document.getElementById('rig');
          this.el.addEventListener('click', () => {
            rig.setAttribute('position', this.data.to);
          });
        }
      });
    </script>

    <style>
      /* optional: make canvas fill window cleanly */
      html, body { margin:0; height:100%; background:#FAFAFA; }
    </style>
  </head>

  <body>
    <a-scene background="color: #FAFAFA"
             cursor="rayOrigin: mouse"
             raycaster="objects: .clickable"
             renderer="colorManagement: true">

      <!-- Lighting / background -->
      <a-sky color="#FAFAFA"></a-sky>
      <a-light type="ambient" intensity="0.8" color="#FAFAFA"></a-light>
      <a-light type="directional" intensity="0.4" color="#FAFAFA" position="4 3 -1"></a-light>
      <a-light type="directional" intensity="0.4" color="#FAFAFA" position="-2 3 -2"></a-light>

      <!-- Preload assets -->
      <a-assets timeout="30000" id="assets">
        <a-asset-item id="gltf" src="./assets/peach_env10.glb" crossorigin="anonymous"></a-asset-item>
        <a-asset-item id="navmesh" src="./assets/peach_nav3.glb" crossorigin="anonymous"></a-asset-item>

        <img id="concrete" src="assets/concrete.jpg" crossorigin="anonymous" />
        <img id="banner" src="assets/banner.jpg" crossorigin="anonymous" />
        <img id="instructions" src="assets/screen2new.jpg" crossorigin="anonymous" />
        <img id="peachposter" src="assets/USDA%20peach.jpg" crossorigin="anonymous" />
        <img id="appleposter" src="assets/USDA%20apple.jpg" crossorigin="anonymous" />
        <img id="plumposter" src="assets/USDA%20plum.jpg" crossorigin="anonymous" />
        <img id="persimmonsposter" src="assets/USDA%20persimmons.jpg" crossorigin="anonymous" />
        <img id="orangeposter" src="assets/USDA%20orange.jpg" crossorigin="anonymous" />
        <img id="strawberryposter" src="assets/USDA%20strawberry.jpg" crossorigin="anonymous" />
      </a-assets>

      <!-- Environment model and images displayed within environment -->
      <a-entity id="object1" gltf-model="#gltf" scale="0.3 0.3 0.3" position="-0.5 1.3 -0.8" visible="true"></a-entity>

      <a-image src="#instructions" position="-0.6 1.2 -0.73" scale="0.7 0.38" rotation="0 0 0"></a-image>
      <a-image src="#banner" position="-0.6 1.9 4.1" scale="4.2 2.28" rotation="0 180 0"></a-image>
      <a-image src="#peachposter" position="2 1.9 -6.37" scale="1.65 2.46" rotation="0 0 0"></a-image>
      <a-image src="#orangeposter" position="-2 1.9 -6.37" scale="1.65 2.46" rotation="0 0 0"></a-image>
      <a-image src="#strawberryposter" position="-5.81 1.9 -4" scale="1.65 2.46" rotation="0 90 0"></a-image>
      <a-image src="#plumposter" position="-5.81 1.9 0" scale="1.65 2.46" rotation="0 90 0"></a-image>
      <a-image src="#appleposter" position="4.65 1.9 0" scale="1.65 2.46" rotation="0 -90 0"></a-image>
      <a-image src="#persimmonsposter" position="4.65 1.9 -4" scale="1.65 2.46" rotation="0 -90 0"></a-image>

      <!-- Floor, walls and navigation mesh -->
      <a-entity gltf-model="#navmesh" scale="0.3 0.3 0.3" position="-0.5 1 -0.8" visible="true" nav-mesh></a-entity>

      <!-- Teleporter markers (hidden until assets load) -->
      <a-entity id="markers" visible="false">
        <a-entity id="marker1" geometry="primitive: tetrahedron" class="clickable" material="color: red" scale="0.2 0.2 0.2" position="0.5 0.92 -2.5" rotation="45 0 45" animation="property: position; from: 0.5 0.52 -1.5; to: 0.5 0.62 -1.5; dur: 2000; easing: linear; dir: alternate; loop: true" animation__2="property: rotation; to: 45 360 45; dur: 4000; easing: linear; loop:true" teleport-to="to: 0.5 0 -1.5"></a-entity>
        <a-entity id="marker2" geometry="primitive: tetrahedron" class="clickable" material="color: red" scale="0.2 0.2 0.2" position="0.5 0.92 -2.5" rotation="45 0 45" animation="property: position; from: 2.5 0.52 -1.5; to: 2.5 0.62 -1.5; dur: 2000; easing: linear; dir: alternate; loop: true" animation__2="property: rotation; to: 45 360 45; dur: 4000; easing: linear; loop:true" teleport-to="to: 2.5 0 -1.5"></a-entity>
        <a-entity id="marker3" geometry="primitive: tetrahedron" class="clickable" material="color: red" scale="0.2 0.2 0.2" position="0.5 0.92 -2.5" rotation="45 0 45" animation="property: position; from: 3 0.52 -2.3; to: 3 0.62 -2.3; dur: 2000; easing: linear; dir: alternate; loop: true" animation__2="property: rotation; to: 45 360 45; dur: 4000; easing: linear; loop:true" teleport-to="to: 3 0 -2.3"></a-entity>
        <a-entity id="marker4" geometry="primitive: tetrahedron" class="clickable" material="color: red" scale="0.2 0.2 0.2" position="0.5 0.92 -2.5" rotation="45 0 45" animation="property: position; from: 2.5 0.52 -3.2; to: 2.5 0.62 -3.2; dur: 2000; easing: linear; dir: alternate; loop: true" animation__2="property: rotation; to: 45 360 45; dur: 4000; easing: linear; loop:true" teleport-to="to: 2.5 0 -3.2"></a-entity>
        <a-entity id="marker5" geometry="primitive: tetrahedron" class="clickable" material="color: red" scale="0.2 0.2 0.2" position="0.5 0.92 -2.5" rotation="45 0 45" animation="property: position; from: 1.7 0.52 -3.2; to: 1.7 0.62 -3.2; dur: 2000; easing: linear; dir: alternate; loop: true" animation__2="property: rotation; to: 45 360 45; dur: 4000; easing: linear; loop:true" teleport-to="to: 1.7 0 -3.2"></a-entity>
        <a-entity id="marker6" geometry="primitive: tetrahedron" class="clickable" material="color: red" scale="0.2 0.2 0.2" position="0.5 0.92 -2.5" rotation="45 0 45" animation="property: position; from: 0.2 0.52 -3.9; to: 0.2 0.62 -3.9; dur: 2000; easing: linear; dir: alternate; loop: true" animation__2="property: rotation; to: 45 360 45; dur: 4000; easing: linear; loop:true" teleport-to="to: 0.2 0 -3.9"></a-entity>
        <a-entity id="marker7" geometry="primitive: tetrahedron" class="clickable" material="color: red" scale="0.2 0.2 0.2" position="0.5 0.92 -2.5" rotation="45 0 45" animation="property: position; from: -1 0.52 -3.9; to: -1 0.62 -3.9; dur: 2000; easing: linear; dir: alternate; loop: true" animation__2="property: rotation; to: 45 360 45; dur: 4000; easing: linear; loop:true" teleport-to="to: -1 0 -3.9"></a-entity>
        <a-entity id="marker8" geometry="primitive: tetrahedron" class="clickable" material="color: red" scale="0.2 0.2 0.2" position="0.5 0.92 -2.5" rotation="45 0 45" animation="property: position; from: -3 0.52 -3.9; to: -3 0.62 -3.9; dur: 2000; easing: linear; dir: alternate; loop: true" animation__2="property: rotation; to: 45 360 45; dur: 4000; easing: linear; loop:true" teleport-to="to: -3 0 -3.9"></a-entity>
        <a-entity id="marker9" geometry="primitive: tetrahedron" class="clickable" material="color: red" scale="0.2 0.2 0.2" position="0.5 0.92 -2.5" rotation="45 0 45" animation="property: position; from: -1 0.52 -5.5; to: -1 0.62 -5.5; dur: 2000; easing: linear; dir: alternate; loop: true" animation__2="property: rotation; to: 45 360 45; dur: 4000; easing: linear; loop:true" teleport-to="to: -1 0 -5.5"></a-entity>
        <a-entity id="marker10" geometry="primitive: tetrahedron" class="clickable" material="color: red" scale="0.2 0.2 0.2" position="0.5 0.92 -2.5" rotation="45 0 45" animation="property: position; from: -5.3 0.52 -2.5; to: -5.3 0.62 -2.5; dur: 2000; easing: linear; dir: alternate; loop: true" animation__2="property: rotation; to: 45 360 45; dur: 4000; easing: linear; loop:true" teleport-to="to: -5.3 0 -2.5"></a-entity>
        <a-entity id="marker11" geometry="primitive: tetrahedron" class="clickable" material="color: red" scale="0.2 0.2 0.2" position="0.5 0.92 -2.5" rotation="45 0 45" animation="property: position; from: -5.3 0.52 -1; to: -5.3 0.62 -1; dur: 2000; easing: linear; dir: alternate; loop: true" animation__2="property: rotation; to: 45 360 45; dur: 4000; easing: linear; loop:true" teleport-to="to: -5.3 0 -1"></a-entity>
        <a-entity id="marker12" geometry="primitive: tetrahedron" class="clickable" material="color: red" scale="0.2 0.2 0.2" position="0.5 0.92 -2.5" rotation="45 0 45" animation="property: position; from: -5.3 0.52 0.8; to: -5.3 0.62 0.8; dur: 2000; easing: linear; dir: alternate; loop: true" animation__2="property: rotation; to: 45 360 45; dur: 4000; easing: linear; loop:true" teleport-to="to: -5.3 0 0.8"></a-entity>
        <a-entity id="marker13" geometry="primitive: tetrahedron" class="clickable" material="color: red" scale="0.2 0.2 0.2" position="0.5 0.92 -2.5" rotation="45 0 45" animation="property: position; from: -3 0.52 2.6; to: -3 0.62 2.6; dur: 2000; easing: linear; dir: alternate; loop: true" animation__2="property: rotation; to: 45 360 45; dur: 4000; easing: linear; loop:true" teleport-to="to: -3 0 2.6"></a-entity>
        <a-entity id="marker14" geometry="primitive: tetrahedron" class="clickable" material="color: red" scale="0.2 0.2 0.2" position="0.5 0.92 -2.5" rotation="45 0 45" animation="property: position; from: 0 0.52 2; to: 0 0.62 2; dur: 2000; easing: linear; dir: alternate; loop: true" animation__2="property: rotation; to: 45 360 45; dur: 4000; easing: linear; loop:true" teleport-to="to: 0 0 2"></a-entity>
        <a-entity id="marker15" geometry="primitive: tetrahedron" class="clickable" material="color: red" scale="0.2 0.2 0.2" position="0.5 0.92 -2.5" rotation="45 0 45" animation="property: position; from: 1.7 0.52 0.2; to: 1.7 0.62 0.2; dur: 2000; easing: linear; dir: alternate; loop: true" animation__2="property: rotation; to: 45 360 45; dur: 4000; easing: linear; loop:true" teleport-to="to: 1.7 0 0.2"></a-entity>
      </a-entity>

      <!-- Player rig (desktop + VR). Desktop uses scene mouse cursor; VR gets a reticle. -->
      <a-entity id="rig" movement-controls="speed: 0.08; constrainToNavMesh: true">
        <a-entity camera position="0 1.6 0" look-controls>
          <a-entity cursor="fuse: false"
                    position="0 0 -1"
                    geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.012"
                    material="shader: flat"></a-entity>
        </a-entity>
        <a-entity oculus-go-controls></a-entity>
        <a-entity oculus-touch-controls></a-entity>
        <a-entity laser-controls="hand: right"></a-entity>
      </a-entity>

    </a-scene>

    <!-- Reveal markers after all assets load -->
    <script>
      document.getElementById('assets').addEventListener('loaded', function () {
        const markers = document.getElementById('markers');
        if (markers) markers.setAttribute('visible', true);
      });
    </script>
  </body>
</html>
